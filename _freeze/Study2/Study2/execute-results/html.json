{
  "hash": "7df263427f9dd0d8f6bb32ae48cd91d0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Predicting Health Outcomes Using NHANES Data: Insights from Multivariable Analyses\"\nauthor: \"Bosco Bakwatanisa\"\ndate: last-modified\nformat: \n html:\n    fig-responsive: true\n    fig-align: center\n    fig-width: 8\n    fig-height: 8\n    page-layout: full\n    theme: flatly\n    embed-resources: true\n    number_sections: TRUE\n    date-format: iso\n    code-fold: false\n    toc: true\n    toc-depth: 3\nexecute:\n  echo: true\n  warning: false\n  message: false\neditor: visual\n---\n\n\n\n\n# 1. Setup and Data Ingest\n\n## 1.1. Loading R packages\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#load required R libraries\nlibrary(nhanesA)\nlibrary(forcats)\nlibrary(boot)\nlibrary(ggplot2)\nlibrary(ggpubr)\nlibrary(kableExtra)\nlibrary(janitor)\nlibrary(naniar)\nlibrary(patchwork)\nlibrary(gridExtra)\nlibrary(mice)\nlibrary(broom.mixed)\nlibrary(Epi)\nlibrary(vcd)\nlibrary(xfun)\nlibrary(epitools)\nlibrary(tidyverse)\ntheme_set(theme_light())  \nknitr::opts_chunk$set(comment=NA)\n```\n:::\n\n\n\n\n# 2. Cleaning the Data\n\n## 2.1. Data preparation\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# pull in data from P_BPXO from NHANES and save it\n\nBMX_raw <- nhanes(\"P_BMX\")|> tibble() \nsaveRDS(BMX_raw, file = \"data/P_BMX.rds\")\ndemo_raw <- nhanes('P_DEMO') |> tibble()\nsaveRDS(demo_raw, file = \"data/P_DEMO.rds\")\nSMQ_raw <- nhanes(\"P_SMQ\")|> tibble()\nsaveRDS(SMQ_raw, file = 'data/SMQ.rds')\ndemo_raw <- readRDS(\"data/P_DEMO.rds\")\nBMX_raw<- readRDS(\"data/P_BMX.rds\")\nDEMO <- demo_raw%>%\n  select(., SEQN,RIDSTATR,RIAGENDR,RIDAGEYR,RIDRETH3 )\n\nBMXBMI <- BMX_raw%>%select(SEQN,BMXBMI)\nanalysis_tibble<- left_join(DEMO, BMXBMI, by = \"SEQN\")\nSMQ_raw <- readRDS(\"data/SMQ.rds\")\nsmoke_data <- SMQ_raw%>% select(SEQN,SMQ020)\nAnalysis2Data <- left_join(analysis_tibble, smoke_data, by = \"SEQN\")\n\nanalysis2Data <- Analysis2Data%>% filter( RIDAGEYR >=21 &  RIDAGEYR<= 79)%>%\n  rename(BMI = BMXBMI, Age = RIDAGEYR, Gender =RIAGENDR, Race = RIDRETH3, Smoking = SMQ020 )%>%\n  mutate(Race = factor(\n    Race,\n    levels = c(\"Mexican American\",\"Other Hispanic\",\"Non-Hispanic White\",    \"Non-Hispanic Black\",\"Non-Hispanic Asian\"),\n    labels = c(\"Mexican\",\"Hispanic\", \"White\",\"Black\", \"Asian\")),Gender = ifelse(Gender == \"Male\", 1,2))%>%filter(BMI > 0)%>%filter(Smoking %in% c('Yes', 'No')) %>%  mutate(\n    Smoking = ifelse(Smoking ==\"Yes\",\"Smoker\",\"Non_Smoker\"))%>% select(SEQN, Age, Gender, Race, Smoking, BMI)%>% mutate(Gender = factor(\n      Gender, levels = c(1,2),labels =c(\"Male\",\"Female\")),Smoking = factor(Smoking,levels = c(\"Smoker\",\"Non_Smoker\"), labels =c(\"Smoker\",\"Non_Smoker\")\n    ))\n\nsaveRDS(analysis2Data, file = 'data/Analyses2Data.rds')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check for missing values\nmissing_summary <- colSums(is.na(analysis2Data))\n\n# Imputation using `mice`\nimputed_data <- mice(analysis2Data, m = 1, method = 'pmm', maxit = 5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n iter imp variable\n  1   1  Race\n  2   1  Race\n  3   1  Race\n  4   1  Race\n  5   1  Race\n```\n\n\n:::\n\n```{.r .cell-code}\ncomplete_data <- complete(imputed_data)\n\n# Display summary\nkable(head(complete_data)) %>%\n  kable_styling(bootstrap_options = \"striped\", full_width = F)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> SEQN </th>\n   <th style=\"text-align:right;\"> Age </th>\n   <th style=\"text-align:left;\"> Gender </th>\n   <th style=\"text-align:left;\"> Race </th>\n   <th style=\"text-align:left;\"> Smoking </th>\n   <th style=\"text-align:right;\"> BMI </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 109266 </td>\n   <td style=\"text-align:right;\"> 29 </td>\n   <td style=\"text-align:left;\"> Female </td>\n   <td style=\"text-align:left;\"> Asian </td>\n   <td style=\"text-align:left;\"> Non_Smoker </td>\n   <td style=\"text-align:right;\"> 37.8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 109271 </td>\n   <td style=\"text-align:right;\"> 49 </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:left;\"> White </td>\n   <td style=\"text-align:left;\"> Smoker </td>\n   <td style=\"text-align:right;\"> 29.7 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 109273 </td>\n   <td style=\"text-align:right;\"> 36 </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:left;\"> White </td>\n   <td style=\"text-align:left;\"> Smoker </td>\n   <td style=\"text-align:right;\"> 21.9 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 109274 </td>\n   <td style=\"text-align:right;\"> 68 </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:left;\"> Hispanic </td>\n   <td style=\"text-align:left;\"> Non_Smoker </td>\n   <td style=\"text-align:right;\"> 30.2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 109282 </td>\n   <td style=\"text-align:right;\"> 76 </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:left;\"> White </td>\n   <td style=\"text-align:left;\"> Smoker </td>\n   <td style=\"text-align:right;\"> 26.6 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 109284 </td>\n   <td style=\"text-align:right;\"> 44 </td>\n   <td style=\"text-align:left;\"> Female </td>\n   <td style=\"text-align:left;\"> Mexican </td>\n   <td style=\"text-align:left;\"> Non_Smoker </td>\n   <td style=\"text-align:right;\"> 39.1 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n# 3. Codebook and Data Description\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvariable_description <- tibble::tribble(\n  ~Variable_Name, ~Role_in_Analysis,~Type, ~Original_Code, ~Definition, ~Cutpoints_or_Units, ~Year_Measured,\n  \"SEQN\",  \"ID\",   \"numeric\",   \" Respondent sequence number\", \"Unique Identifier to identify any persons involved in the study\" ,  \"N/A\",      \"2017-March 2020\",\n  \"RIDSTATR\",\"Interview/Examination status\",\"Categorical\",\"RIDSTATR\",\"Variable used to show whether a participant was either interviewed only or both interviewed and MEC Examined\",\"Number of persons\",\"2017-March 2020\",\n  \"Gender\",  \"Analysis Key Predictor\", \"Categorical\", \"RIAGENDR\",\"Gender of the participant\",\"Persons (Male or Female)\",      \"2017-March 2020\",\n  \"RIDAGEYR\", \"Analysis key predictor and used to select Adult persons aged 21-79 years\",\"numeric\",\"RIDAGEYR\", \"Participant's Age in years at the time of screening \",   \"21 -79 years\",\"2017-March 2020\",   \n  \"Race/Ethnicity\", \"Analysis Predictor\",  \"Categorical\", \"RIDRETH3 \", \"RIDRETH3: This is the race-ethnicity variable included in the demographics file since the 2011-2012 survey cycle to accommodate the oversample of Asian Americans. It was derived from responses to the survey questions on race and Hispanic origin.\nRespondents who self-identified as “Mexican American” were coded as such (i.e., RIDRETH3=1) regardless of their other race-ethnicity identities. Otherwise, self-identified “Hispanic” ethnicity would result in code “2, Other Hispanic” in the RIDRETH3 variable.\nAll other non-Hispanic participants would then be categorized based on their self-reported races: non-Hispanic white (RIDRETH3=3), non-Hispanic black (RIDRETH3=4), non-Hispanic Asian (RIDRETH3=6)\", \"Number of participants who identified as Race/Hispanic origin w/ NH Asian\", \"2017-March 2020\",\n  \"BMI\",\"Analysis Outocome\", \"numeric\", \"BMXBMI\", \"Body Mass Index (BMI) was calculated as weight in kilograms divided by height in meters squared, and then rounded to one decimal place.\",  \"(kg/m**2)\", \"2017-March 2020\",\n  \"Smoking\", \"Analysis Predictor\",  \"Categorical(yes, no)\", \"SMQ020\", \"Smoked at least 100 cigarettes in life, (yes for smoked, no never smoked\",\"Number of participants interviewed\", \"2017-March 2020\")\nvariable_description |> kbl() |> kable_styling()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Variable_Name </th>\n   <th style=\"text-align:left;\"> Role_in_Analysis </th>\n   <th style=\"text-align:left;\"> Type </th>\n   <th style=\"text-align:left;\"> Original_Code </th>\n   <th style=\"text-align:left;\"> Definition </th>\n   <th style=\"text-align:left;\"> Cutpoints_or_Units </th>\n   <th style=\"text-align:left;\"> Year_Measured </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> SEQN </td>\n   <td style=\"text-align:left;\"> ID </td>\n   <td style=\"text-align:left;\"> numeric </td>\n   <td style=\"text-align:left;\"> Respondent sequence number </td>\n   <td style=\"text-align:left;\"> Unique Identifier to identify any persons involved in the study </td>\n   <td style=\"text-align:left;\"> N/A </td>\n   <td style=\"text-align:left;\"> 2017-March 2020 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> RIDSTATR </td>\n   <td style=\"text-align:left;\"> Interview/Examination status </td>\n   <td style=\"text-align:left;\"> Categorical </td>\n   <td style=\"text-align:left;\"> RIDSTATR </td>\n   <td style=\"text-align:left;\"> Variable used to show whether a participant was either interviewed only or both interviewed and MEC Examined </td>\n   <td style=\"text-align:left;\"> Number of persons </td>\n   <td style=\"text-align:left;\"> 2017-March 2020 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Gender </td>\n   <td style=\"text-align:left;\"> Analysis Key Predictor </td>\n   <td style=\"text-align:left;\"> Categorical </td>\n   <td style=\"text-align:left;\"> RIAGENDR </td>\n   <td style=\"text-align:left;\"> Gender of the participant </td>\n   <td style=\"text-align:left;\"> Persons (Male or Female) </td>\n   <td style=\"text-align:left;\"> 2017-March 2020 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> RIDAGEYR </td>\n   <td style=\"text-align:left;\"> Analysis key predictor and used to select Adult persons aged 21-79 years </td>\n   <td style=\"text-align:left;\"> numeric </td>\n   <td style=\"text-align:left;\"> RIDAGEYR </td>\n   <td style=\"text-align:left;\"> Participant's Age in years at the time of screening </td>\n   <td style=\"text-align:left;\"> 21 -79 years </td>\n   <td style=\"text-align:left;\"> 2017-March 2020 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Race/Ethnicity </td>\n   <td style=\"text-align:left;\"> Analysis Predictor </td>\n   <td style=\"text-align:left;\"> Categorical </td>\n   <td style=\"text-align:left;\"> RIDRETH3 </td>\n   <td style=\"text-align:left;\"> RIDRETH3: This is the race-ethnicity variable included in the demographics file since the 2011-2012 survey cycle to accommodate the oversample of Asian Americans. It was derived from responses to the survey questions on race and Hispanic origin.\nRespondents who self-identified as “Mexican American” were coded as such (i.e., RIDRETH3=1) regardless of their other race-ethnicity identities. Otherwise, self-identified “Hispanic” ethnicity would result in code “2, Other Hispanic” in the RIDRETH3 variable.\nAll other non-Hispanic participants would then be categorized based on their self-reported races: non-Hispanic white (RIDRETH3=3), non-Hispanic black (RIDRETH3=4), non-Hispanic Asian (RIDRETH3=6) </td>\n   <td style=\"text-align:left;\"> Number of participants who identified as Race/Hispanic origin w/ NH Asian </td>\n   <td style=\"text-align:left;\"> 2017-March 2020 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> BMI </td>\n   <td style=\"text-align:left;\"> Analysis Outocome </td>\n   <td style=\"text-align:left;\"> numeric </td>\n   <td style=\"text-align:left;\"> BMXBMI </td>\n   <td style=\"text-align:left;\"> Body Mass Index (BMI) was calculated as weight in kilograms divided by height in meters squared, and then rounded to one decimal place. </td>\n   <td style=\"text-align:left;\"> (kg/m**2) </td>\n   <td style=\"text-align:left;\"> 2017-March 2020 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Smoking </td>\n   <td style=\"text-align:left;\"> Analysis Predictor </td>\n   <td style=\"text-align:left;\"> Categorical(yes, no) </td>\n   <td style=\"text-align:left;\"> SMQ020 </td>\n   <td style=\"text-align:left;\"> Smoked at least 100 cigarettes in life, (yes for smoked, no never smoked </td>\n   <td style=\"text-align:left;\"> Number of participants interviewed </td>\n   <td style=\"text-align:left;\"> 2017-March 2020 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n# 4. My Research Question\n\n### **4.1. Problem Statement**\n\nBody Mass Index (BMI) is a widely used indicator for assessing body fat based on height and weight. Gender differences in BMI may arise due to biological, hormonal, and societal factors influencing body composition, metabolism, lifestyle behaviors among others. Understanding how BMI varies with gender within a population while taking into account other confounding factors such as age, race/ethnicity, and smoking status may provide us with insights on how this association may influence the gender based health outcomes within the United States population.\n\n### 4.2. Research Question\n\nIs there significant relationship between Body Mass Index (BMI) and gender, while adjusting for an individual's age, race/ethnicity, and smoking status?\n\n# 5. Partitioning the Data\n\nHere, I divide my analysis data into training and testing data sets in the ratio of 70% to 30%. This provides us with an oppo\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Split analysis data into training (70%) and testing (30%)\nset.seed(112724)\ntraining_data <- complete_data %>% slice_sample(prop = 0.7)\ntesting_data <- anti_join(complete_data, training_data, by = \"SEQN\")\n\n# Confirm split\nnrow(training_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 5412\n```\n\n\n:::\n\n```{.r .cell-code}\nnrow(testing_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 2320\n```\n\n\n:::\n\n```{.r .cell-code}\nsaveRDS(training_data, file = \"data/training_data.rds\")\nsaveRDS(testing_data, file = \"data/testing_data.rds\")\n```\n:::\n\n\n\n\n# 6. Transforming the Outcome\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Histogram and Q-Q Plot\np1 <- ggplot(training_data, aes(x = BMI)) +\n  geom_histogram(bins = 50,binwidth = 3, fill = \"blue\", alpha = 0.7) +\n  labs(title = \"BMI Distribution\")+\n  theme_classic(base_size = 10) +\n  theme(legend.position = \"left\",\n        axis.text = element_text(face = \"bold\",size = 10),\n        axis.title.y = element_text(face = \"bold\", size = 10),\n        axis.title.x = element_text(face = \"bold\", size = 10),\n        plot.title = element_text(face = \"bold\", hjust = 0.5, size = 10))\n\np2 <- ggplot(training_data, aes(sample = BMI)) +\n  geom_qq(col = \"slateblue\") + \n  geom_qq_line(col = \"magenta\") + \n  theme(aspect.ratio = 1) + \n  labs(title = \"Normal Q-Q: NHANES BMI\")+\n  theme_classic(base_size = 12) +\n  theme(legend.position = \"none\",\n        axis.text = element_text(face = \"bold\",size = 10),\n        axis.title.y = element_text(face = \"bold\", size = 10),\n        axis.title.x = element_text(face = \"bold\", size = 10),\n        plot.title = element_text(face = \"bold\", hjust = 0.5, size = 10))\np1 + p2\n```\n\n::: {.cell-output-display}\n![](Study2_files/figure-html/unnamed-chunk-5-1.png){width=768}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Histogram and Q-Q Plot for log transformed BMI\np1 <- ggplot(training_data, aes(x = log(BMI))) +\n  geom_histogram(bin = 50,binwidth = .08, fill = \"blue\", alpha = 0.7) +\n  labs(title = \"log(BMI) Distribution\")+\n  theme_classic(base_size = 10) +\n  theme(legend.position = \"left\",\n        axis.text = element_text(face = \"bold\",size = 10),\n        axis.title.y = element_text(face = \"bold\", size = 10),\n        axis.title.x = element_text(face = \"bold\", size = 10),\n        plot.title = element_text(face = \"bold\", hjust = 0.5, size = 10))\n\np2 <- ggplot(training_data, aes(sample = log(BMI))) +\n  geom_qq(col = \"slateblue\") + \n  geom_qq_line(col = \"magenta\") + \n  theme(aspect.ratio = 1) + \n  labs(title = \"Normal Q-Q: NHANES log(BMI)\")+\n  theme_classic(base_size = 12) +\n  theme(legend.position = \"none\",\n        axis.text = element_text(face = \"bold\",size = 10),\n        axis.title.y = element_text(face = \"bold\", size = 10),\n        axis.title.x = element_text(face = \"bold\", size = 10),\n        plot.title = element_text(face = \"bold\", hjust = 0.5, size = 10))\np1 + p2\n```\n\n::: {.cell-output-display}\n![](Study2_files/figure-html/unnamed-chunk-6-1.png){width=768}\n:::\n:::\n\n\n\n\n# 7. The Big Model\n\nUsing the training data, I fitted a multivariate linear regression model as a means of assessing the association between Gender and Body mass index and other confounding variables of age, race/ethnicity, and smoking status\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Big Model\nbig_model <- lm(BMI ~ Gender + Age + Race + Smoking, data = training_data)\nsummary(big_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = BMI ~ Gender + Age + Race + Smoking, data = training_data)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-16.913  -4.988  -1.109   3.712  60.028 \n\nCoefficients:\n                   Estimate Std. Error t value Pr(>|t|)    \n(Intercept)       29.473581   0.447677  65.837  < 2e-16 ***\nGenderFemale       1.298694   0.208274   6.236 4.84e-10 ***\nAge                0.012713   0.006432   1.976   0.0482 *  \nRaceHispanic      -0.711835   0.417715  -1.704   0.0884 .  \nRaceWhite         -0.683471   0.338672  -2.018   0.0436 *  \nRaceBlack          0.941633   0.341858   2.754   0.0059 ** \nRaceAsian         -4.828790   0.400275 -12.064  < 2e-16 ***\nSmokingNon_Smoker  0.126308   0.216608   0.583   0.5598    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 7.526 on 5404 degrees of freedom\nMultiple R-squared:  0.05924,\tAdjusted R-squared:  0.05802 \nF-statistic: 48.62 on 7 and 5404 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy(big_model)%>% kable(digits = 3)%>%kable_styling(bootstrap_options = \"striped\", full_width = F)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 29.474 </td>\n   <td style=\"text-align:right;\"> 0.448 </td>\n   <td style=\"text-align:right;\"> 65.837 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> GenderFemale </td>\n   <td style=\"text-align:right;\"> 1.299 </td>\n   <td style=\"text-align:right;\"> 0.208 </td>\n   <td style=\"text-align:right;\"> 6.236 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Age </td>\n   <td style=\"text-align:right;\"> 0.013 </td>\n   <td style=\"text-align:right;\"> 0.006 </td>\n   <td style=\"text-align:right;\"> 1.976 </td>\n   <td style=\"text-align:right;\"> 0.048 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> RaceHispanic </td>\n   <td style=\"text-align:right;\"> -0.712 </td>\n   <td style=\"text-align:right;\"> 0.418 </td>\n   <td style=\"text-align:right;\"> -1.704 </td>\n   <td style=\"text-align:right;\"> 0.088 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> RaceWhite </td>\n   <td style=\"text-align:right;\"> -0.683 </td>\n   <td style=\"text-align:right;\"> 0.339 </td>\n   <td style=\"text-align:right;\"> -2.018 </td>\n   <td style=\"text-align:right;\"> 0.044 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> RaceBlack </td>\n   <td style=\"text-align:right;\"> 0.942 </td>\n   <td style=\"text-align:right;\"> 0.342 </td>\n   <td style=\"text-align:right;\"> 2.754 </td>\n   <td style=\"text-align:right;\"> 0.006 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> RaceAsian </td>\n   <td style=\"text-align:right;\"> -4.829 </td>\n   <td style=\"text-align:right;\"> 0.400 </td>\n   <td style=\"text-align:right;\"> -12.064 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> SmokingNon_Smoker </td>\n   <td style=\"text-align:right;\"> 0.126 </td>\n   <td style=\"text-align:right;\"> 0.217 </td>\n   <td style=\"text-align:right;\"> 0.583 </td>\n   <td style=\"text-align:right;\"> 0.560 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglance(big_model)%>% kable(digits = 3)%>% kable_styling(bootstrap_options = \"striped\", full_width = F)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> r.squared </th>\n   <th style=\"text-align:right;\"> adj.r.squared </th>\n   <th style=\"text-align:right;\"> sigma </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n   <th style=\"text-align:right;\"> df </th>\n   <th style=\"text-align:right;\"> logLik </th>\n   <th style=\"text-align:right;\"> AIC </th>\n   <th style=\"text-align:right;\"> BIC </th>\n   <th style=\"text-align:right;\"> deviance </th>\n   <th style=\"text-align:right;\"> df.residual </th>\n   <th style=\"text-align:right;\"> nobs </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 0.059 </td>\n   <td style=\"text-align:right;\"> 0.058 </td>\n   <td style=\"text-align:right;\"> 7.526 </td>\n   <td style=\"text-align:right;\"> 48.615 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> -18598.78 </td>\n   <td style=\"text-align:right;\"> 37215.55 </td>\n   <td style=\"text-align:right;\"> 37274.92 </td>\n   <td style=\"text-align:right;\"> 306097.4 </td>\n   <td style=\"text-align:right;\"> 5404 </td>\n   <td style=\"text-align:right;\"> 5412 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#Extracting the residuals from the model\nresiduals <- resid(big_model)\nfitted_values <- fitted(big_model)\n```\n:::\n\n\n\n\nDiagnostic Plots\n\nTo check whether the fitted model meets the linearity assumption, normality of residuals, homoscedasticity, and influential points, I extracted the residuals and their fitted values to plot the 'Residuals vs. Fitted Plot', normality Q-Q plot, Scale-location plot, and the residuals vs. leverage plot as shown below.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Residuals vs Fitted Plot\np1<- ggplot(data = data.frame(fitted_values, residuals), aes(x = fitted_values, y = residuals)) +\n  geom_point(color = \"blue\", alpha = 0.6) +\n  geom_hline(yintercept = 0, linetype = \"dashed\", color = \"red\") +\n  labs(title = \"Residuals vs Fitted\",\n       x = \"Fitted Values\",\n       y = \"Residuals\") +\n  theme_classic(base_size = 12) +\n  theme(\n        axis.text = element_text(face = \"bold\",size = 9),\n        axis.title.y = element_text(face = \"bold\", size = 9),\n        axis.title.x = element_text(face = \"bold\", size = 9),\n        plot.title = element_text(face = \"bold\", hjust = 0.5, size = 10))\n\n# Normal Q-Q Plot\np2 <- ggplot(data = data.frame(residuals), aes(sample = residuals)) +\n  stat_qq() +\n  stat_qq_line(color = \"red\") +\n  labs(title = \"Normal Q-Q Plot\",\n       x = \"Theoretical Quantiles\",\n       y = \"Sample Quantiles\") +\n  theme_classic(base_size = 12) +\n  theme(\n        axis.text = element_text(face = \"bold\",size = 9),\n        axis.title.y = element_text(face = \"bold\", size = 9),\n        axis.title.x = element_text(face = \"bold\", size = 9),\n        plot.title = element_text(face = \"bold\", hjust = 0.5, size = 10))\n\n# Scale-Location Plot\nsqrt_abs_residuals <- sqrt(abs(residuals))\np3 <- ggplot(data = data.frame(fitted_values, sqrt_abs_residuals), aes(x = fitted_values, y = sqrt_abs_residuals)) +\n  geom_point(color = \"blue\", alpha = 0.6) +\n  geom_smooth(method = \"loess\", color = \"red\", se = FALSE) +\n  labs(title = \"Scale-Location Plot\",\n       x = \"Fitted Values\",\n       y = \"√|Residuals|\") +\n    theme_classic(base_size = 12) +\n  theme(\n        axis.text = element_text(face = \"bold\",size = 9),\n        axis.title.y = element_text(face = \"bold\", size = 9),\n        axis.title.x = element_text(face = \"bold\", size = 9),\n        plot.title = element_text(face = \"bold\", hjust = 0.5, size = 10))\n\n# Residuals vs Leverage Plot\nleverage <- hatvalues(big_model)\np4 <- ggplot(data = data.frame(leverage, residuals), aes(x = leverage, y = residuals)) +\n  geom_point(color = \"blue\", alpha = 0.6) +\n  geom_hline(yintercept = 0, linetype = \"dashed\", color = \"red\") +\n  labs(title = \"Residuals vs Leverage\",\n       x = \"Leverage\",\n       y = \"Residuals\") +\n   theme_classic(base_size = 12) +\n  theme(\n        axis.text = element_text(face = \"bold\",size = 9),\n        axis.title.y = element_text(face = \"bold\", size = 9),\n        axis.title.x = element_text(face = \"bold\", size = 9),\n        plot.title = element_text(face = \"bold\", hjust = 0.5, size = 10))\n\np1 + p2 + p3 + p4\n```\n\n::: {.cell-output-display}\n![](Study2_files/figure-html/unnamed-chunk-11-1.png){width=768}\n:::\n:::\n\n\n\n\nFrom the residuals vs. Fitted plot, I observed that the residuals do not appear to ne randomly scattered around the red dashed horizontal line at zero and there are clusters indicating non-linearity. The spread of residuals seemed to increase slightly for higher fitted values, suggesting heteroscedasticity. The normal Q-Q plot shows that residuals deviate from the red line, particularly in the top tail, indicating that residuals are not normally distributed, hence suggesting skewness. Additionally, from the Scale-location plot, the red trend line shows a slight upward slope, suggesting increasing variance of residuals with fitted values. This altogether points to violation of assumptions for homoscedasticity, linearity, normality of residuals.\n\n# 8. The Smaller Model\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Smaller Model\nsmall_model <- lm(BMI ~ Gender, data = training_data)\nsummary(small_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = BMI ~ Gender, data = training_data)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-16.163  -5.333  -1.298   3.867  61.537 \n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   29.5329     0.1525 193.625  < 2e-16 ***\nGenderFemale   1.2296     0.2104   5.843 5.43e-09 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 7.731 on 5410 degrees of freedom\nMultiple R-squared:  0.006271,\tAdjusted R-squared:  0.006087 \nF-statistic: 34.14 on 1 and 5410 DF,  p-value: 5.433e-09\n```\n\n\n:::\n:::\n\n\n\n\n# 9. In-Sample Comparison\n\n```         \n```\n\n## 9.1. Quality of Fit\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# R-Squared and Adjusted R-Squared\nr_squared_big <- summary(big_model)$r.squared\nadj_r_squared_big <- summary(big_model)$adj.r.squared\n\nr_squared_small <- summary(small_model)$r.squared\nadj_r_squared_small <- summary(small_model)$adj.r.squared\n\n# AIC and BIC\naic_big <- AIC(big_model)\nbic_big <- BIC(big_model)\n\naic_small <- AIC(small_model)\nbic_small <- BIC(small_model)\n\n# Log-Likelihood\nloglik_big <- logLik(big_model)\nloglik_small <- logLik(small_model)\n\n# Create a summary table\nquality_of_fit <- data.frame(\n  Model = c(\"Big Model\", \"Small Model\"),\n  R_Squared = c(r_squared_big, r_squared_small),\n  Adjusted_R_Squared = c(adj_r_squared_big, adj_r_squared_small),\n  AIC = c(aic_big, aic_small),\n  BIC = c(bic_big, bic_small),\n  Log_Likelihood = c(loglik_big, loglik_small)\n)\n\n# Print the table\nprint(quality_of_fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        Model   R_Squared Adjusted_R_Squared      AIC      BIC Log_Likelihood\n1   Big Model 0.059242435         0.05802384 37215.55 37274.92      -18598.78\n2 Small Model 0.006270614         0.00608693 37500.02 37519.81      -18747.01\n```\n\n\n:::\n:::\n\n\n\n\n## 9.2. Posterior Predictive Checks\n\n## 9.3. Assessing Assumptions\n\n## 9.4. Comparing the Models\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncomparison <- data.frame(\n  Model = c(\"Big Model\", \"Small Model\"),\n  R_squared = c(summary(big_model)$r.squared, summary(small_model)$r.squared),\n  AIC = c(AIC(big_model), AIC(small_model)),\n  BIC = c(BIC(big_model), BIC(small_model))\n)\n\nkable(comparison) %>%\n  kable_styling(bootstrap_options = \"striped\", full_width = F)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Model </th>\n   <th style=\"text-align:right;\"> R_squared </th>\n   <th style=\"text-align:right;\"> AIC </th>\n   <th style=\"text-align:right;\"> BIC </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Big Model </td>\n   <td style=\"text-align:right;\"> 0.0592424 </td>\n   <td style=\"text-align:right;\"> 37215.55 </td>\n   <td style=\"text-align:right;\"> 37274.92 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Small Model </td>\n   <td style=\"text-align:right;\"> 0.0062706 </td>\n   <td style=\"text-align:right;\"> 37500.02 </td>\n   <td style=\"text-align:right;\"> 37519.81 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n# 10. Model Validation\n\n## 10.1. Calculating Prediction Errors\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Model </th>\n   <th style=\"text-align:right;\"> RMSPE </th>\n   <th style=\"text-align:right;\"> MAPE </th>\n   <th style=\"text-align:right;\"> R2 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Big Model </td>\n   <td style=\"text-align:right;\"> 7.265033 </td>\n   <td style=\"text-align:right;\"> 5.412963 </td>\n   <td style=\"text-align:right;\"> 0.0626770 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Small Model </td>\n   <td style=\"text-align:right;\"> 7.469028 </td>\n   <td style=\"text-align:right;\"> 5.632456 </td>\n   <td style=\"text-align:right;\"> 0.0090505 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate residuals for both models\nresiduals_big <- testing_data$BMI - test_predictions_big\nresiduals_small <- testing_data$BMI - test_predictions_small\n\n# Mean Absolute Error (MAE)\nmae_big <- mean(abs(residuals_big))\nmae_small <- mean(abs(residuals_small))\n\n# Root Mean Squared Error (RMSE)\nrmse_big <- sqrt(mean(residuals_big^2))\nrmse_small <- sqrt(mean(residuals_small^2))\n\n# R-squared for predictions\nsst <- sum((testing_data$BMI - mean(testing_data$BMI))^2)  # Total Sum of Squares\nsse_big <- sum(residuals_big^2)  # Sum of Squared Errors for big model\nsse_small <- sum(residuals_small^2)  # Sum of Squared Errors for small model\n\nr_squared_big <- 1 - (sse_big / sst)\nr_squared_small <- 1 - (sse_small / sst)\n\n# Create a summary table\ncomparison_table <- data.frame(\n  Model = c(\"Big Model\", \"Small Model\"),\n  MAE = c(mae_big, mae_small),\n  RMSE = c(rmse_big, rmse_small),\n  R_Squared = c(r_squared_big, r_squared_small)\n)\n\n# Print the table\nprint(comparison_table)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        Model      MAE     RMSE  R_Squared\n1   Big Model 5.412963 7.265033 0.06140739\n2 Small Model 5.632456 7.469028 0.00795793\n```\n\n\n:::\n:::\n\n\n\n\n## 10.2. Visualizing the Predictions\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\n# Combine predictions and observed data\ntesting_data$Pred_Big <- test_predictions_big\ntesting_data$Pred_Small <- test_predictions_small\n\n# Plot for Big Model\nggplot(testing_data, aes(x = Pred_Big, y = BMI)) +\n  geom_point(color = \"blue\", alpha = 0.5) +\n  geom_abline(slope = 1, intercept = 0, color = \"red\", linetype = \"dashed\") +\n  labs(title = \"Predicted vs Observed: Big Model\",\n       x = \"Predicted BMI (Big Model)\",\n       y = \"Observed BMI\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Study2_files/figure-html/unnamed-chunk-17-1.png){width=768}\n:::\n\n```{.r .cell-code}\n# Plot for Small Model\nggplot(testing_data, aes(x = Pred_Small, y = BMI)) +\n  geom_point(color = \"green\", alpha = 0.5) +\n  geom_abline(slope = 1, intercept = 0, color = \"red\", linetype = \"dashed\") +\n  labs(title = \"Predicted vs Observed: Small Model\",\n       x = \"Predicted BMI (Small Model)\",\n       y = \"Observed BMI\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Study2_files/figure-html/unnamed-chunk-17-2.png){width=768}\n:::\n:::\n\n\n\n\n## 10.3. Summarizing the Errors\n\n## 10.4. Comparing the Models\n\n# 11. Discussion\n\n## 11.1. Chosen Model\n\n## 11.2. Answering My Question\n\n## 11.3. Next Steps\n\n## 11.4. Reflection\n\n# 12. Session Information\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsession_info()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14)\nPlatform: aarch64-apple-darwin20\nRunning under: macOS Sonoma 14.5\n\nLocale: en_US.UTF-8 / en_US.UTF-8 / en_US.UTF-8 / C / en_US.UTF-8 / en_US.UTF-8\n\nPackage version:\n  abind_1.4-5            askpass_1.2.0          backports_1.5.0       \n  base64enc_0.1.3        bit_4.0.5              bit64_4.0.5           \n  blob_1.2.4             boot_1.3-30            broom_1.0.6           \n  broom.mixed_0.2.9.6    bslib_0.8.0            cachem_1.1.0          \n  callr_3.7.6            car_3.1-2              carData_3.0-5         \n  cellranger_1.1.0       cli_3.6.3              clipr_0.8.0           \n  cmprsk_2.2-12          coda_0.19.4.1          codetools_0.2-20      \n  colorspace_2.1-1       compiler_4.4.1         conflicted_1.2.0      \n  corrplot_0.94          cowplot_1.1.3          cpp11_0.4.7           \n  crayon_1.5.3           curl_6.0.1             data.table_1.16.0     \n  DBI_1.2.3              dbplyr_2.5.0           Deriv_4.1.3           \n  digest_0.6.37          doBy_4.6.22            dplyr_1.1.4           \n  dtplyr_1.3.1           Epi_2.53               epitools_0.5-10.1     \n  etm_1.1.1              evaluate_0.24.0        fansi_1.0.6           \n  farver_2.1.2           fastmap_1.2.0          fontawesome_0.5.2     \n  forcats_1.0.0          foreach_1.5.2          foreign_0.8-86        \n  fs_1.6.4               furrr_0.3.1            future_1.34.0         \n  gargle_1.5.2           generics_0.1.3         ggplot2_3.5.1         \n  ggpubr_0.6.0           ggrepel_0.9.5          ggsci_3.2.0           \n  ggsignif_0.6.4         glmnet_4.1-8           globals_0.16.3        \n  glue_1.7.0             googledrive_2.1.1      googlesheets4_1.1.1   \n  graphics_4.4.1         grDevices_4.4.1        grid_4.4.1            \n  gridExtra_2.3          gtable_0.3.5           haven_2.5.4           \n  highr_0.11             hms_1.1.3              htmltools_0.5.8.1     \n  htmlwidgets_1.6.4      httr_1.4.7             ids_1.0.1             \n  isoband_0.2.7          iterators_1.0.14       janitor_2.2.0         \n  jomo_2.7-6             jquerylib_0.1.4        jsonlite_1.8.8        \n  kableExtra_1.4.0       knitr_1.48             labeling_0.4.3        \n  lattice_0.22-6         lifecycle_1.0.4        listenv_0.9.1         \n  lme4_1.1-35.5          lmtest_0.9-40          lubridate_1.9.3       \n  magrittr_2.0.3         MASS_7.3-60.2          Matrix_1.7-0          \n  MatrixModels_0.5.3     memoise_2.0.1          methods_4.4.1         \n  mgcv_1.9-1             mice_3.16.0            microbenchmark_1.4.10 \n  mime_0.12              minqa_1.2.8            mitml_0.4-5           \n  modelr_0.1.11          munsell_0.5.1          naniar_1.1.0          \n  nhanesA_1.1            nlme_3.1-164           nloptr_2.1.1          \n  nnet_7.3-19            norm_1.0.11.1          numDeriv_2016.8-1.1   \n  openssl_2.2.1          ordinal_2023.12.4.1    pan_1.9               \n  parallel_4.4.1         parallelly_1.38.0      patchwork_1.2.0       \n  pbkrtest_0.5.3         pillar_1.9.0           pkgconfig_2.0.3       \n  plyr_1.8.9             polynom_1.4.1          prettyunits_1.2.0     \n  processx_3.8.4         progress_1.2.3         ps_1.7.7              \n  purrr_1.0.2            quantreg_5.98          R6_2.5.1              \n  ragg_1.3.2             rappdirs_0.3.3         RColorBrewer_1.1.3    \n  Rcpp_1.0.13            RcppArmadillo_14.0.0.1 RcppEigen_0.3.4.0.1   \n  readr_2.1.5            readxl_1.4.3           rematch_2.0.0         \n  rematch2_2.1.2         reprex_2.1.1           rlang_1.1.4           \n  rmarkdown_2.28         rpart_4.1.23           rstatix_0.7.2         \n  rstudioapi_0.16.0      rvest_1.0.4            sass_0.4.9            \n  scales_1.3.0           selectr_0.4-2          shape_1.4.6.1         \n  snakecase_0.11.1       SparseM_1.84.2         splines_4.4.1         \n  stats_4.4.1            stringi_1.8.4          stringr_1.5.1         \n  survival_3.6-4         svglite_2.1.3          sys_3.4.2             \n  systemfonts_1.1.0      textshaping_0.4.0      tibble_3.2.1          \n  tidyr_1.3.1            tidyselect_1.2.1       tidyverse_2.0.0       \n  timechange_0.3.0       tinytex_0.52           tools_4.4.1           \n  tzdb_0.4.0             ucminf_1.2.2           UpSetR_1.4.0          \n  utf8_1.2.4             utils_4.4.1            uuid_1.2.1            \n  vcd_1.4-12             vctrs_0.6.5            viridis_0.6.5         \n  viridisLite_0.4.2      visdat_0.6.0           vroom_1.6.5           \n  withr_3.0.1            xfun_0.47              xml2_1.3.6            \n  yaml_2.3.10            zoo_1.8-12            \n```\n\n\n:::\n:::\n",
    "supporting": [
      "Study2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}